FROM ubuntu  
  
MAINTAINER Mike Gardiner <conversationing@gmail.com>  
  
# Let the conatiner know that there is no tty  
ENV DEBIAN_FRONTEND noninteractive  
  
RUN apt-get update && \  
apt-get -y install openssh-server git && \  
rm -rf /var/lib/apt/lists/*  
  
# Enable all supported locales, for the generation process see also:  
# - https://people.debian.org/~schultmc/locales.html  
# - https://wiki.debian.org/Locale  
RUN cp /usr/share/i18n/SUPPORTED /etc/locale.gen  
RUN locale-gen  
  
RUN mkdir /var/run/sshd  
  
RUN adduser --system --group --shell /bin/sh git  
RUN su git -c "mkdir /home/git/bin"  
  
RUN cd /home/git; su git -c "git clone git://github.com/sitaramc/gitolite";  
RUN cd /home/git/gitolite; su git -c "git checkout master";  
RUN cd /home/git; su git -c "gitolite/install -ln";  
  
# https://github.com/docker/docker/issues/5892  
RUN chown -R git:git /home/git  
  
# http://stackoverflow.com/questions/22547939/docker-gitlab-container-ssh-git-
login-error  
RUN sed -i '/session required pam_loginuid.so/d' /etc/pam.d/sshd  
  
# Remove SSH host keys, so they will be generated by /init  
RUN rm -f /etc/ssh/ssh_host_*  
  
ADD ./init.sh /init  
  
# Addind volume to repositories directory  
VOLUME /home/git/repositories  
VOLUME /etc/ssh  
  
RUN chmod +x /init  
ENTRYPOINT ["/init", "/usr/sbin/sshd", "-D"]  
  
EXPOSE 22  

